name: Orchestrator Auto

on:
  workflow_dispatch:
  schedule:
    - cron: "17 8 * * *"    # 08:17 UTC daily (03:17 America/Detroit) - auto mode
    - cron: "47 20 * * *"   # 20:47 UTC daily (15:47 America/Detroit) - auto mode

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'
      - run: pnpm install --frozen-lockfile
      - run: pnpm exec playwright install --with-deps chromium || true
      - name: Run orchestrator
        env:
          DATA_ROOT: ${{ github.workspace }}/data
          ORCH_CONCURRENCY: 2
          ORCH_RETRIES: 2
        run: |
          node orchestrate.js run auto
      - name: Upload latest run folders (best-effort)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: runs_${{ github.run_id }}
          path: data/nevada-epro/**/*
          if-no-files-found: ignore
